---
title: "Create Test Sample for Extraction"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## Creating Test Samples

This notebook creates stratified test samples of different sizes for testing extraction before processing the full dataset.

```{r load-packages}
library(dplyr)
library(readr)

data_dir <- "../data/fusarium"
```

**Result**: Ready for sampling.

## Load Filtered Dataset

```{r load-data}
ecophys_data <- readRDS(file.path(data_dir, "fusarium_ecophysiology_subset.rds"))

cat("✓ Ecophysiology subset loaded\n")
cat("  Total studies:", nrow(ecophys_data), "\n")
```

**Result**: Filtered ecophysiology dataset loaded.

## Create Multiple Sample Sizes

Create samples of different sizes for iterative testing.

```{r create-samples}
set.seed(123)  # Reproducibility

# Sample sizes for testing
sample_sizes <- c(10, 50, 100)

for (size in sample_sizes) {
  # Stratified sample across topics
  sample_data <- ecophys_data %>%
    group_by(topic) %>%
    slice_sample(n = min(ceiling(size/6), n())) %>%  # Proportional sampling
    ungroup() %>%
    slice_sample(n = min(size, n()))  # Limit to target size

  # Save sample
  sample_file <- file.path(data_dir, sprintf("sample_%d_studies.rds", size))
  saveRDS(sample_data, sample_file)

  cat(sprintf("✓ Created sample of %d studies: %s\n", nrow(sample_data), sample_file))
}
```

**Result**: Test samples of 10, 50, and 100 studies created.

## Sample Characteristics

Verify sample representativeness.

```{r sample-characteristics}
sample_10 <- readRDS(file.path(data_dir, "sample_10_studies.rds"))

cat("\n10-Study Sample Characteristics:\n")
cat("  Topics represented:\n")
print(table(sample_10$topic))

cat("\n  Sample titles:\n")
for (i in 1:nrow(sample_10)) {
  cat(sprintf("  %d. %s\n", i, substr(sample_10$title[i], 1, 70)))
}
```

**Result**: Test samples are stratified across topics.

## Summary

```{r summary}
cat("\n")
cat("╔════════════════════════════════════════════════════╗\n")
cat("║        TEST SAMPLES CREATED                        ║\n")
cat("╚════════════════════════════════════════════════════╝\n")
cat("\n")

cat("Available datasets:\n")
cat("  Full corpus:", nrow(readRDS(file.path(data_dir, "fusarium_studies_extraction_ready.rds"))), "studies\n")
cat("  Ecophysiology subset:", nrow(ecophys_data), "studies\n")
cat("  Test sample (10):", nrow(readRDS(file.path(data_dir, "sample_10_studies.rds"))), "studies\n")
cat("  Test sample (50):", nrow(readRDS(file.path(data_dir, "sample_50_studies.rds"))), "studies\n")
cat("  Test sample (100):", nrow(readRDS(file.path(data_dir, "sample_100_studies.rds"))), "studies\n")
cat("\nRecommended extraction workflow:\n")
cat("  1. Test on 10 studies first\n")
cat("  2. Refine prompts and validate\n")
cat("  3. Scale to 50 studies\n")
cat("  4. Run full ecophysiology subset\n")
```

**Result**: Multiple test samples available for iterative extraction development.

## Next Steps

1. ✓ Created stratified test samples
2. Next: Design extraction schema in `0300_design_extraction_schema.Rmd`
