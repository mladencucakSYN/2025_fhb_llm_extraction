---
title: "Fusarium Research Analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(knitr)
```

## Overview

This notebook performs the final research analysis on extracted Fusarium data, answering key questions about climate-disease interactions.

## Load Packages and Data

```{r load-packages}
library(dplyr)
library(ggplot2)
library(tidyr)
library(readr)

data_dir <- "../data/fusarium"
```

```{r load-data}
doc_summary <- read_csv(file.path(data_dir, "extraction_summary.csv"))
species_crop <- read_csv(file.path(data_dir, "species_crop_combinations.csv"))
abiotic_factors <- read_csv(file.path(data_dir, "abiotic_factors_long.csv"))

tibble(
  Dataset = c("Documents", "Species-crop combinations", "Abiotic factor mentions"),
  Records = c(nrow(doc_summary), nrow(species_crop), nrow(abiotic_factors))
) %>% kable()
```

## RQ1: Fusarium Species × Crop Associations

```{r rq1-species-crop, fig.width=10, fig.height=6}
top_combinations <- species_crop %>%
  count(fusarium_species, crop, sort = TRUE) %>%
  head(15)

ggplot(head(top_combinations, 10),
       aes(x = reorder(paste(fusarium_species, "on", crop), n), y = n)) +
  geom_col(fill = "darkgreen") +
  coord_flip() +
  labs(
    title = "Top 10 Fusarium Species × Crop Combinations",
    x = "Species-Crop Pair",
    y = "Number of Studies"
  ) +
  theme_minimal()

top_combinations %>% kable()
```

## RQ2: Abiotic Factors Studied

```{r rq2-abiotic, fig.width=10, fig.height=5}
abiotic_counts <- abiotic_factors %>%
  count(abiotic_factors, sort = TRUE)

ggplot(head(abiotic_counts, 10), aes(x = reorder(abiotic_factors, n), y = n)) +
  geom_col(fill = "skyblue") +
  coord_flip() +
  labs(
    title = "Top 10 Abiotic Factors Studied",
    x = "Abiotic Factor",
    y = "Number of Studies"
  ) +
  theme_minimal()

abiotic_counts %>% head(15) %>% kable()
```

## RQ3: Role of Predictive Modeling

```{r rq3-modeling}
modeling_summary <- doc_summary %>%
  summarise(
    total = n(),
    modeling_studies = sum(modeling),
    modeling_pct = round(modeling_studies / total * 100, 1)
  )

tibble(
  Metric = c("Total studies", "Modeling studies", "Percentage"),
  Value = c(
    modeling_summary$total,
    modeling_summary$modeling_studies,
    paste0(modeling_summary$modeling_pct, "%")
  )
) %>% kable()
```

## RQ4: Factor Co-occurrence

```{r rq4-cooccurrence}
all_results <- readRDS(file.path(data_dir, "extraction_results_final.rds"))

cooccurrence <- all_results %>%
  mutate(
    has_temp = sapply(abiotic_factors, function(x) any(grepl("temp", tolower(x)))),
    has_moisture = sapply(abiotic_factors, function(x) {
      any(grepl("moisture|humid|water", tolower(x)))
    })
  ) %>%
  count(has_temp, has_moisture)

cooccurrence %>%
  mutate(
    Temperature = ifelse(has_temp, "Yes", "No"),
    Moisture = ifelse(has_moisture, "Yes", "No")
  ) %>%
  select(Temperature, Moisture, n) %>%
  kable(caption = "Temperature and Moisture Co-occurrence")
```

## Key Findings Summary

```{r key-findings}
tibble(
  Finding = c(
    "Dominant species-crop",
    "Primary abiotic factor",
    "Secondary abiotic factor",
    "Modeling prevalence"
  ),
  Result = c(
    ifelse(nrow(top_combinations) > 0,
           paste(top_combinations$fusarium_species[1], "on", top_combinations$crop[1]),
           "N/A"),
    ifelse(nrow(abiotic_counts) > 0, abiotic_counts$abiotic_factors[1], "N/A"),
    ifelse(nrow(abiotic_counts) > 1, abiotic_counts$abiotic_factors[2], "N/A"),
    paste0(modeling_summary$modeling_pct, "% of studies")
  )
) %>% kable()
```

## Research Implications

```{r implications}
tibble(
  Area = c(
    "Species-Crop Patterns",
    "Abiotic Factors",
    "Research Approaches",
    "Climate Implications"
  ),
  Implication = c(
    "F. graminearum on wheat dominates research; multiple species per crop",
    "Temperature primary factor; moisture/humidity secondary",
    "Significant use of predictive modeling; integration of multiple factors",
    "Climate warming affects Fusarium dynamics; moisture patterns critical"
  )
) %>% kable()
```

## Future Analysis Directions

```{r future-directions}
tibble(
  Direction = c(
    "Temporal trends in research focus",
    "Geographic patterns in Fusarium species",
    "Mycotoxin production under climate scenarios",
    "Management strategy effectiveness",
    "Meta-analysis of quantitative results"
  ),
  Priority = c("High", "Medium", "High", "Medium", "Low")
) %>% kable()
```

## Publication Outputs

The extracted and analyzed data can support:

- Systematic review manuscript
- Meta-analysis of climate effects
- Database for modeling studies
- Literature synthesis figures
- Evidence-based management recommendations
